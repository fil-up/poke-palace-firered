---
phase: 01-build-tools
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - pokefirered/Makefile
  - pokefirered/data/questions/species_map.json
  - pokefirered/data/questions/.gitkeep
autonomous: true
must_haves:
  truths:
    - "`make questions` regenerates C files from CSV"
    - "Species mapping JSON defines question-to-species relationships"
  artifacts:
    - pokefirered/data/questions/species_map.json
    - Makefile questions target
  key_links:
    - "Makefile target calls Python scripts in correct order"
---

<objective>
Integrate the Python build tools into the Makefile build system and create the initial species mapping configuration. This enables `make questions` to regenerate question data from CSV.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@pokefirered/Makefile (first 100 lines)

The Makefile uses GNU Make with various tool targets. Need to add a `questions` target that:
1. Validates the CSV
2. Generates C files
3. Can be called independently or as part of the build

Species mapping format:
```json
{
  "SPECIES_RATTATA": {
    "maps": ["MAP_ROUTE1"],
    "questions": ["MQ.3.001", "MQ.3.002", "MQ.3.003", "MQ.3.004", "MQ.3.005"]
  },
  "SPECIES_PIDGEY": {
    "maps": ["MAP_ROUTE1", "MAP_ROUTE2"],
    "questions": ["MQ.3.006", "MQ.3.007", "MQ.3.008", "MQ.3.009", "MQ.3.010"]
  }
}
```
</context>

<tasks>
<task type="auto">
  <name>Add Makefile questions target</name>
  <files>pokefirered/Makefile</files>
  <action>
Add to Makefile:

```makefile
# Quiz question generation
QUESTION_CSV ?= ../GH\ 101\ Question\ Bank\ -\ Sheet1.csv
SPECIES_MAP := data/questions/species_map.json
QUESTIONS_GEN_H := include/quiz/questions_gen.h
QUESTIONS_GEN_C := src/quiz/questions_gen.c

questions: $(QUESTIONS_GEN_H) $(QUESTIONS_GEN_C)

$(QUESTIONS_GEN_H) $(QUESTIONS_GEN_C): $(QUESTION_CSV) $(SPECIES_MAP)
	python3 tools/quiz/validate_questions.py "$(QUESTION_CSV)"
	python3 tools/quiz/build_questions.py "$(QUESTION_CSV)" --mapping "$(SPECIES_MAP)" --out-dir .

.PHONY: questions
```

Add `questions` as a dependency of the main build if QUESTION_CSV exists.
Place this section near other tool-related targets in the Makefile.
  </action>
  <verify>
Run `make questions` - should execute Python scripts (will fail until scripts exist, but target should be recognized)
  </verify>
  <done>
- `make questions` target exists
- Target has correct dependencies
- Uses configurable CSV path via QUESTION_CSV variable
  </done>
</task>

<task type="auto">
  <name>Create initial species mapping</name>
  <files>
pokefirered/data/questions/species_map.json
pokefirered/data/questions/.gitkeep
  </files>
  <action>
Create data/questions/ directory structure.

Create species_map.json with initial Route 1 mapping:
```json
{
  "_comment": "Maps species to question IDs. Questions are selected based on species encountered.",
  "SPECIES_RATTATA": {
    "maps": ["MAP_ROUTE1"],
    "difficulty_range": [1, 3],
    "questions": []
  },
  "SPECIES_PIDGEY": {
    "maps": ["MAP_ROUTE1", "MAP_ROUTE2"],
    "difficulty_range": [1, 3],
    "questions": []
  }
}
```

Note: Question IDs will be populated in Phase 8 (Route 1 Content). The empty arrays are placeholders that the build script should handle gracefully.
  </action>
  <verify>JSON is valid (python -m json.tool species_map.json)</verify>
  <done>
- species_map.json exists with valid JSON
- Structure supports species-to-question mapping
- Build script handles empty question arrays
  </done>
</task>

<task type="checkpoint:human-verify">
  <name>Verify build integration</name>
  <files>pokefirered/Makefile</files>
  <action>
After both plans in Phase 1 are complete:
1. Run `make questions` 
2. Verify questions_gen.h and questions_gen.c are created
3. Run `make` to verify the generated files compile
4. Check that the ROM still builds and runs
  </action>
  <verify>Manual testing in emulator</verify>
  <done>
- `make questions` succeeds
- `make` compiles without errors
- ROM boots in emulator
  </done>
</task>
</tasks>

<verification>
1. `make questions` is a valid target
2. `make -n questions` shows the Python script commands
3. species_map.json passes JSON validation
4. Full build completes after integration
</verification>

<success_criteria>
- Makefile has working `questions` target
- Species mapping JSON structure is established
- Build system ready to generate questions when scripts are complete
</success_criteria>
