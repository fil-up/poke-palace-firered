---
phase: 13-damage-only-moves
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pokefirered/src/quiz/quiz_hooks.c
  - pokefirered/src/quiz/move_rules.c
  - pokefirered/include/quiz/move_rules.h
autonomous: true
must_haves:
  truths:
    - "Only direct-damage moves can be used in battle"
    - "No secondary effects or multi-turn/counter mechanics occur"
  artifacts:
    - path: "pokefirered/src/quiz/move_rules.c"
      provides: "Damage-only move predicate and helper utilities"
      exports: ["Quiz_IsDamageOnlyMove"]
    - path: "pokefirered/include/quiz/move_rules.h"
      provides: "Public move rules API"
      contains: "Quiz_IsDamageOnlyMove"
    - path: "pokefirered/src/quiz/quiz_hooks.c"
      provides: "Battle-time enforcement of damage-only moves"
      contains: "QuizHooks_FillPartyMoves|QuizHooks_FillEnemyMoves"
  key_links:
    - from: "pokefirered/src/quiz/quiz_hooks.c"
      to: "pokefirered/src/data/battle_moves.h"
      via: "gBattleMoves lookups"
      pattern: "gBattleMoves"
    - from: "pokefirered/src/quiz/quiz_hooks.c"
      to: "pokefirered/include/constants/battle_move_effects.h"
      via: "EFFECT_HIT"
      pattern: "EFFECT_HIT"
---

<objective>
Enforce a strict damage-only move ruleset using Quiz hooks so that no status moves, secondary effects, multi-turn mechanics, counters, terrain, or Destiny Bond can occur in battle.

Purpose: Keep battles deterministic and aligned with the quiz gameplay loop by ensuring every selectable move is a simple, immediate damage hit.

Output: A small quiz-side move rules module and hook updates that replace any invalid moves with known safe filler moves at battle start and menu display.
</objective>

<execution_context>
@C:\Users\phill\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\phill\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/todos/pending/2026-01-29-ensure-only-attacking-moves.md
@pokefirered/src/quiz/quiz_hooks.c
@pokefirered/src/data/battle_moves.h
@pokefirered/include/constants/battle_move_effects.h
@pokefirered/include/constants/moves.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add damage-only move rules module</name>
  <files>
    pokefirered/src/quiz/move_rules.c
    pokefirered/include/quiz/move_rules.h
  </files>
  <action>
Create a tiny quiz-local API that centralizes what counts as a valid move:

**Header (`move_rules.h`):**
- Declare `bool8 Quiz_IsDamageOnlyMove(u16 move);`

**Source (`move_rules.c`):**
- Include `battle.h` (for `gBattleMoves`) and `constants/battle_move_effects.h`
- Implement `Quiz_IsDamageOnlyMove` with strict checks:
  - `move != MOVE_NONE`
  - `gBattleMoves[move].power > 0`
  - `gBattleMoves[move].effect == EFFECT_HIT`
  - `gBattleMoves[move].secondaryEffectChance == 0`

This intentionally excludes multi-hit, recoil, counter, multi-turn, and any status/field effects.
  </action>
  <verify>
Build check: `cd pokefirered && make -j$(nproc)` completes with no errors.
  </verify>
  <done>
`move_rules.c/h` exists and exports `Quiz_IsDamageOnlyMove` with strict damage-only criteria.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enforce damage-only moves at battle init</name>
  <files>
    pokefirered/src/quiz/quiz_hooks.c
  </files>
  <action>
Update the existing move-filling logic to use the new rules:

- Include `quiz/move_rules.h`
- In `QuizHooks_FillPartyMoves` and `QuizHooks_FillEnemyMoves`, replace the current
  `power == 0` check with `!Quiz_IsDamageOnlyMove(move)` so any invalid move is replaced
  with a safe filler move.
- Ensure `sFillerMoves` remains limited to moves that pass `Quiz_IsDamageOnlyMove`.

This keeps all edits inside the quiz hook boundary.
  </action>
  <verify>
Manual spot-check in ROM: open a battle with a Pokemon that normally has a status move
(e.g., Growl) and confirm the move list contains only damaging moves.
  </verify>
  <done>
All invalid moves are replaced at battle init for both player and enemy parties.
  </done>
</task>

<task type="auto">
  <name>Task 3: Re-validate player moves when command menu appears</name>
  <files>
    pokefirered/src/quiz/quiz_hooks.c
  </files>
  <action>
Add a small safety pass for mid-battle changes:

- Add a helper that validates the active player battler's move list and replaces any
  invalid move with filler moves (same logic as Task 2).
- Call this helper from `QuizHooks_OnCommandMenuShown`, so any move changes from
  edge cases are cleaned up before the player selects a move.
  </action>
  <verify>
In emulator, open the command menu multiple times in a battle and confirm no non-damage
moves appear and no status/secondary effects trigger during execution.
  </verify>
  <done>
Player move list is re-validated on command menu display, preventing edge-case violations.
  </done>
</task>

</tasks>

<verification>
1. **Build verification:** `cd pokefirered && make -j$(nproc)` succeeds
2. **Move rules API exists:** `rg "Quiz_IsDamageOnlyMove" pokefirered/src/quiz/move_rules.c`
3. **Hooks updated:** `rg "Quiz_IsDamageOnlyMove" pokefirered/src/quiz/quiz_hooks.c`
4. **In-game checks:** status move and multi-turn move never appear in battle menus
</verification>

<success_criteria>
- Only `EFFECT_HIT` moves with power > 0 and no secondary effect are selectable
- No status, terrain, counter, or multi-turn effects occur during battle
- Enforcement lives in quiz modules and `quiz_hooks.c` only
</success_criteria>

<output>
After completion, create `.planning/phases/13-damage-only-moves/13-01-SUMMARY.md`
</output>
