---
phase: 15-per-species-questions
plan: 02
type: execute
wave: 2
depends_on: [15-01]
files_modified:
  - pokefirered/data/questions/species_map.json
  - pokefirered/src/quiz/questions_gen.c
  - pokefirered/include/quiz/questions_gen.h
autonomous: true

must_haves:
  truths:
    - "Each species has 5 questions assigned from the 727 question pool"
    - "Questions assigned by difficulty tier matching game progression"
    - "Species banks generated for all 150+ catchable species"
  artifacts:
    - path: "pokefirered/data/questions/species_map.json"
      provides: "Species-to-question mapping for all catchable Pokemon"
      contains: "SPECIES_* to question ID mappings"
    - path: "pokefirered/src/quiz/questions_gen.c"
      provides: "Generated species question banks"
      contains: "Quiz_GetBank implementations"
---

<objective>
Assign all 727 questions to specific species based on difficulty tiers.

Purpose: Enable per-species question selection by mapping questions to Pokemon based on difficulty, ensuring early-game species get easier questions and late-game species get harder ones.

Output:
- Updated species_map.json with 150+ species mapped to questions
- Regenerated questions_gen.c with species banks
</objective>

<execution_context>
@C:\Users\phill\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\phill\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-per-species-questions/15-SPECIES-MAP.md
@pokefirered/data/questions/questions.csv
@pokefirered/data/questions/species_map.json
@pokefirered/tools/quiz/build_questions.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create difficulty tier mapping</name>
  <files>.planning/phases/15-per-species-questions/15-DIFFICULTY-TIERS.md</files>
  <action>
Create a reference document mapping species to difficulty tiers:

**Tier 1 (Easy - Difficulty 1)**: ~30 species
- Section 1-2 species (Pre-Brock, Pre-Misty)
- Examples: Rattata, Pidgey, Caterpie, Weedle, Zubat, Geodude

**Tier 2 (Medium-Easy - Difficulty 2)**: ~30 species
- Section 3 species (Pre-Surge)
- Examples: Meowth, Mankey, Diglett, Drowzee

**Tier 3 (Medium - Difficulty 3)**: ~35 species
- Section 4-5 species (Pre-Erika, Pre-Koga)
- Examples: Machop, Onix, Safari Zone species

**Tier 4 (Medium-Hard - Difficulty 4)**: ~30 species
- Section 6-7 species (Pre-Sabrina, Pre-Blaine)
- Examples: Trade evolutions, fossil Pokemon, legendaries (Articuno)

**Tier 5 (Hard - Difficulty 5)**: ~25 species
- Section 8 species (Pre-Champion)
- Examples: Victory Road species, Mewtwo, Zapdos, Moltres
  </action>
  <verify>Document covers all 150+ species with tier assignments</verify>
  <done>Difficulty tier mapping complete</done>
</task>

<task type="auto">
  <name>Task 2: Analyze question distribution by difficulty</name>
  <files>pokefirered/data/questions/questions.csv</files>
  <action>
Analyze the 727 questions by difficulty level:

1. Count questions per difficulty (1-5)
2. Calculate: 150 species × 5 questions = 750 needed, we have 727
3. Determine distribution strategy:
   - If difficulty distribution is uneven, some species may get 4 questions
   - Or use questions across tiers (tier 1 species can get difficulty 1-2 questions)

Expected distribution for balanced coverage:
- 145 questions per difficulty level (727/5 = 145.4)
- Each species gets 5 questions from their tier (or adjacent tier)
  </action>
  <verify>Print question count per difficulty: `grep -c "difficulty" or similar analysis`</verify>
  <done>Question distribution analyzed and assignment strategy defined</done>
</task>

<task type="auto">
  <name>Task 3: Update species_map.json with full roster</name>
  <files>pokefirered/data/questions/species_map.json</files>
  <action>
Expand species_map.json to include all 150+ catchable species:

Structure per species:
```json
{
  "SPECIES_RATTATA": {
    "maps": ["MAP_ROUTE1"],
    "difficulty_range": [1, 1],
    "questions": ["CH03-001", "CH03-002", "CH03-003", "CH03-004", "CH03-005"]
  },
  "SPECIES_PIDGEY": {
    "maps": ["MAP_ROUTE1"],
    "difficulty_range": [1, 1],
    "questions": ["CH03-006", "CH03-007", "CH03-008", "CH03-009", "CH03-010"]
  }
}
```

Use the difficulty tier mapping from Task 1 to assign:
- Tier 1 species → difficulty 1 questions
- Tier 2 species → difficulty 2 questions
- etc.

Distribute the 727 questions across all species evenly.
  </action>
  <verify>JSON valid: `python3 -c "import json; d=json.load(open('pokefirered/data/questions/species_map.json')); print(len(d), 'species mapped')"`</verify>
  <done>species_map.json contains 150+ species with question assignments</done>
</task>

<task type="auto">
  <name>Task 4: Regenerate questions_gen.c with species banks</name>
  <files>
    pokefirered/src/quiz/questions_gen.c
    pokefirered/include/quiz/questions_gen.h
  </files>
  <action>
Run the build script to regenerate question banks:

```bash
cd pokefirered
python3 tools/quiz/build_questions.py \
  --csv data/questions/questions.csv \
  --species data/questions/species_map.json \
  --output-c src/quiz/questions_gen.c \
  --output-h include/quiz/questions_gen.h
```

Verify generated code includes:
1. Species bank structs for all 150+ species
2. Quiz_GetBank(species) function returning correct bank
3. Question data with all fields populated
  </action>
  <verify>Build succeeds: `cd pokefirered && make -j4`</verify>
  <done>questions_gen.c regenerated with full species banks</done>
</task>

</tasks>

<verification>
1. species_map.json contains 150+ species entries
2. Each species has 4-5 questions assigned
3. Questions distributed by difficulty tier
4. questions_gen.c regenerated with species banks
5. Build succeeds: `cd pokefirered && make -j4`
</verification>

<success_criteria>
- All 150+ catchable species mapped to questions
- Question difficulty matches species game progression
- Quiz_GetBank(species) returns valid bank for all mapped species
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-per-species-questions/15-02-SUMMARY.md`
</output>
