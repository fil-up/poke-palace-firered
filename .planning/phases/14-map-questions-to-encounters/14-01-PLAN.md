---
phase: 14-map-questions-to-encounters
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pokefirered/tools/quiz/inventory_species.py
  - pokefirered/data/questions/species_map.json
  - pokefirered/include/quiz/questions_gen.h
  - pokefirered/src/quiz/questions_gen.c
autonomous: true

must_haves:
  truths:
    - "All 130 wild encounter species have question bank mappings"
    - "Each species has 5 questions assigned from the 727 available"
    - "Generated C code compiles without errors"
  artifacts:
    - path: "pokefirered/tools/quiz/inventory_species.py"
      provides: "Species extraction from wild_encounters.json"
      min_lines: 50
    - path: "pokefirered/data/questions/species_map.json"
      provides: "All species â†’ question mappings"
      contains: "SPECIES_ABRA"
    - path: "pokefirered/src/quiz/questions_gen.c"
      provides: "Generated question banks for all species"
      contains: "gQuizBank_SPECIES_ABRA"
  key_links:
    - from: "pokefirered/tools/quiz/inventory_species.py"
      to: "pokefirered/data/questions/species_map.json"
      via: "JSON output"
      pattern: "json.dump"
    - from: "pokefirered/data/questions/species_map.json"
      to: "pokefirered/src/quiz/questions_gen.c"
      via: "build_questions.py"
      pattern: "gQuizBank_SPECIES_"
---

<objective>
Expand species_map.json to cover all 130 wild encounter species with question assignments.

Purpose: Currently only 12 species have question banks. This plan inventories all encounterable species from wild_encounters.json and assigns questions from the 727 available, enabling full game coverage.

Output: Updated species_map.json with all species, regenerated questions_gen.c/.h with ~130 question banks.
</objective>

<execution_context>
@C:\Users\phill\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\phill\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-map-questions-to-encounters/14-RESEARCH.md

@pokefirered/data/questions/species_map.json
@pokefirered/tools/quiz/build_questions.py
@pokefirered/src/data/wild_encounters.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create species inventory script</name>
  <files>pokefirered/tools/quiz/inventory_species.py</files>
  <action>
Create a Python script that:
1. Parses `pokefirered/src/data/wild_encounters.json` to extract all unique species
2. Groups species by map for reference (output as comment in JSON)
3. Loads existing `species_map.json` to preserve current 12 species' question assignments
4. Loads `questions.csv` to get all available question IDs (727 valid)
5. Assigns 5 questions per species, distributing evenly across difficulty levels where possible
6. Outputs expanded `species_map.json` maintaining the existing format:
   ```json
   {
     "SPECIES_NAME": {
       "maps": ["MAP_XYZ"],
       "difficulty_range": [1, 5],
       "questions": ["CH03-001", "CH03-002", ...]
     }
   }
   ```

Question assignment strategy:
- Preserve existing 12 species' question assignments exactly
- For new species, assign 5 questions round-robin from available pool
- Track which questions are already assigned to avoid duplicates where possible
- If 727 questions / 130 species = ~5.6 per species, some sharing is acceptable

The script should:
- Accept `--encounters` path to wild_encounters.json
- Accept `--questions` path to questions.csv  
- Accept `--existing` path to current species_map.json
- Accept `--output` path for expanded species_map.json
- Print summary: species count, questions assigned, any warnings

Usage: `python inventory_species.py --encounters ../src/data/wild_encounters.json --questions ../data/questions/questions.csv --existing ../data/questions/species_map.json --output ../data/questions/species_map.json`
  </action>
  <verify>
Run: `cd pokefirered/tools/quiz && python inventory_species.py --help`
Verify script accepts expected arguments.
  </verify>
  <done>
Script exists, parses wild_encounters.json, extracts 130 unique species, and can generate expanded species_map.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate expanded species_map.json and rebuild C code</name>
  <files>
pokefirered/data/questions/species_map.json
pokefirered/include/quiz/questions_gen.h
pokefirered/src/quiz/questions_gen.c
  </files>
  <action>
1. Run the inventory script to generate expanded species_map.json:
   ```bash
   cd pokefirered/tools/quiz
   python inventory_species.py \
     --encounters ../../src/data/wild_encounters.json \
     --questions ../../data/questions/questions.csv \
     --existing ../../data/questions/species_map.json \
     --output ../../data/questions/species_map.json
   ```

2. Verify the expanded species_map.json:
   - Contains all 130 species from wild_encounters.json
   - Each species has 5 questions assigned
   - Original 12 species retain their existing question assignments

3. Run build_questions.py to regenerate C code:
   ```bash
   cd pokefirered/data/questions
   python ../../tools/quiz/build_questions.py questions.csv \
     --mapping species_map.json \
     --out-dir ../../
   ```

4. Verify generated files:
   - `include/quiz/questions_gen.h` has extern declarations for all ~130 banks
   - `src/quiz/questions_gen.c` has all `gQuizBank_SPECIES_*` definitions
   - `Quiz_GetBank()` switch statement covers all 130 species

5. Build to verify compilation:
   ```bash
   cd pokefirered && make -j4
   ```
  </action>
  <verify>
- `grep -c "gQuizBank_SPECIES" pokefirered/include/quiz/questions_gen.h` returns ~130
- `grep -c "case SPECIES_" pokefirered/src/quiz/questions_gen.c` returns ~130
- `make` completes without errors
  </verify>
  <done>
species_map.json contains 130 species, questions_gen.c/.h generated with all banks, project compiles.
  </done>
</task>

</tasks>

<verification>
1. species_map.json has entries for all 130 wild encounter species
2. Each species entry has exactly 5 questions assigned
3. questions_gen.h declares extern for ~130 gQuizBank_SPECIES_* structs
4. questions_gen.c defines all banks and Quiz_GetBank() switch covers all species
5. Project builds without errors
</verification>

<success_criteria>
- [ ] inventory_species.py created and functional
- [ ] species_map.json expanded from 12 to 130 species
- [ ] questions_gen.c/.h regenerated with all species banks
- [ ] `make` succeeds with no compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-map-questions-to-encounters/14-01-SUMMARY.md`
</output>
